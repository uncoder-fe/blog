name: deploy gh-pages

on:
  push:
    branches:
      - master

jobs:
  build:
    runs-on: macOS-latest
    env:
      TOKEN: ${{ secrets.COMMIT_TOKEN }}
      USER_NAME: uncoder-fe
      USER_EMAIL: uncoder-fe@fake.com
    steps:
      - name: "Checkout"
        uses: actions/checkout@v2
        with:
          submodules: true
          token: ${{ secrets.COMMIT_TOKEN }}
          repository: uncoder-fe/blog-backup
      - name: "install hugo"
        run: |
          cd ..
          brew install hugo
          hugo new site myblog
          mkdir myblog/content/posts
          hugo mod init github.com/theNewDynamic/gohugo-theme-ananke
          mv -f $GITHUB_WORKSPACE/config.toml myblog/config.toml
          cat myblog/config.toml
          mv $GITHUB_WORKSPACE/*.md myblog/content/posts
          echo "ÂºÄÂßãÊûÑÂª∫........."
          cd myblog
          hugo --minify
          echo "ÊûÑÂª∫ÊàêÂäü"
          echo "ÂºÄÂßã‰∏ä‰º†ÁõÆÊ†á‰ªìÂ∫ì"
          cd ./public
          git init
          git config --local user.name $USER_NAME
          git config --local user.email $USER_EMAIL
          git status
          git remote add origin https://$TOKEN@github.com/uncoder-fe/uncoder-fe.github.io.git
          git add .
          git commit -m "Update by github actions"
          git push origin master -f
          echo ü§ò deploy master complete.
